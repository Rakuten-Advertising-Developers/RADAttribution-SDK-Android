<HTML>
<HEAD>
<meta charset="UTF-8">
<title>radattribution-sdk-android</title>
<link rel="stylesheet" href="../style.css">
</HEAD>
<BODY>
<a href="./index.html">radattribution-sdk-android</a><br/>
<br/>
<h2>RADAttribution Android SDK</h2>
<p>Rakuten advertising attribution SDK allows advertisers to track app installs and in-app conversion events using any affiliate link promoted within a publisherâ€™s mobile app or on a mobile web page.</p>
<h3>Requires Android API level 21+</h3>
<h3>Create public/private key pairs</h3>
<p>Our SDK internally uses a private key to sign a JSON Web Token(JWT).
This token is passed to our Attribution backend system to verify the SDK's identity. </p>
<p>Generate public/private key pairs with the following commands</p>
<pre><code class="lang-sh">openssl genpkey -algorithm RSA -out rad_rsa_private.pem -pkeyopt rsa_keygen_bits:256
openssl rsa -in rad_rsa_private.pem -pubout -out rad_rsa_public.pem
</code></pre>
<p>This command will create the following two files.</p>
<ol><li>rad_rsa_private.pem: Store this private key securely.</li>
<li>rad_rsa_public.pem: This file is required by Rakuten Attribution backend platform to verify the signature of the authentication JWT. 
(Public key handover process will be communicated separately)</li>
</ol>
<h4>Setup RADAttribution SDK initialization</h4>
<p>To start working with RADAttribution SDK you need to create an instance of Configuration class. 
It's constructor takes three parameters: </p>
<ul><li>appId (unique android application id. You can get it from any Context class instance of your appilication)</li>
<li>privateKey (content of your rad_rsa_private.pem file, with both header and footer removed)</li>
<li>isManualAppLaunch (flag that indicates if application was opened from link with the associated domain)</li>
</ul>
<pre><code class="lang-kotlin">val configuration = Configuration(
                appId = context.packageName,
                privateKey = your_private_key,
                isManualAppLaunch = false
        )
</code></pre>
<p>Then you need to initiate RAdAttribution object with you application's context class and created Configuration instance</p>
<pre><code class="lang-kotlin">RAdAttribution.setup(context, configuration)
</code></pre>
<h4>Send events with metadata</h4>
<p>Radattribution SDK provides a way to send events.</p>
<p>To send evend to server you have to call sendEvent() method of EventSender sdk class. 
The only required parameter of this method is 'name'</p>
<pre><code class="lang-kotlin">RAdAttribution.eventSender.sendEvent(name = "PURCHASE")
</code></pre>
<p>Optionally you can pass an instance of EventData class, with event's metadata. </p>
<pre><code class="lang-kotlin">val eventData = EventData(
             transactionId = "112233",
             searchQuery = "shoe products",
             currency = "USD",
             revenue = selectedProduct?.price,
             shipping = 0.0,
             tax = 0.8,
             coupon = "coupon_test_code",
             affiliation = "affilation code",
             description = "description"
     ) 
</code></pre>
<p>and/or array of ContentItem insances. ContentItem class contains info related to purchase items, like price, tax, etc. </p>
<pre><code class="lang-kotlin">val contentItems = arrayOf(
                ContentItem(
                        sku = "77889900",
                        productName = selectedProduct!!.name,
                        quantity = 12,
                        price = selectedProduct.price
                )
        )
</code></pre>
<p>Also you can pass data with CustomData class, which is just alias for Map&lt;String, String&gt; </p>
<pre><code class="lang-kotlin">val customData = mapOf(
                "customkey1" to "value1",
                "customekey2" to "value2"
        )
</code></pre>
<p>Optionally you can pass lambda to be called on operation result. </p>
<p>So your sendEvent() call might look like this </p>
<pre><code class="lang-kotlin">  RAdAttribution.eventSender.sendEvent(
                name = action,
                customData = customData,
                eventData = eventData,
                contentItems = contentItems
        ) { result -&gt;
            when (result) {
                is Result.Success -&gt; {
                }
                is Result.Error -&gt; {
                }
            }
        }
</code></pre>
<h4>Resolve application's deep links</h4>
<p>Another feature of Radattribution SDK is to handle application's deep links and handle it's metadata.
Firstly you need to add an &lt;intent-filter&gt; section to you AndroidManifest.xml file. 
To let operation system know that your application is able open http ans https links in rakutenadvertising.app.link domain</p>
<pre><code class="lang-xml"> &lt;intent-filter android:label="@string/app_name"&gt;
                &lt;action android:name="android.intent.action.VIEW" /&gt;
                &lt;category android:name="android.intent.category.DEFAULT" /&gt;
                &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
                &lt;data android:host="rakutenadvertising.app.link"
                    android:scheme="http" /&gt;
                &lt;data android:host="rakutenadvertising.app.link"
                    android:scheme="https" /&gt;
 &lt;/intent-filter&gt; 
</code></pre>
<p>Now links like  "https://rakutenadvertising.app.link/..." and "http://rakutenadvertising.app.link/..." will be prompted to open with your application.</p>
<p>Also you can specify suctom app scheme instead of "http" and "https". For example it's "demo_app" for our demo application. 
You can put your application scheme to your gradle.build in buildTypes section like this</p>
<pre><code class="lang-groovy"> buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
        buildTypes.each {
            it.buildConfigField 'String', 'APP_SCHEME', "\"demo_app\""
            it.resValue 'string', 'APP_SCHEME', "\"demo_app\""
        }
    }
</code></pre>
<p>Then you can add another &lt;intent-filter&gt; to your AndroidManifest.xml file     </p>
<pre><code class="lang-xml"> &lt;intent-filter android:label="@string/app_name"&gt;
                &lt;action android:name="android.intent.action.VIEW" /&gt;
                &lt;category android:name="android.intent.category.DEFAULT" /&gt;
                &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
                &lt;data android:host="open"
                    android:scheme="@string/APP_SCHEME" /&gt;
 &lt;/intent-filter&gt;
</code></pre>
<p>Now links like "demo_app://open?link_click_id=..." will be opened with your application automatically.</p>
<p>Then you have to add handleIntent() method to your MainActivity class. 
As you can see it checks if applications is started with one of known schemes: "http", "https" or your custom scheme. </p>
<pre><code class="lang-kotlin">private fun handleIntent(intent: Intent) {
        if (intent.action == Intent.ACTION_VIEW) {
            when (intent.scheme) {
                "http", "https", BuildConfig.APP_SCHEME -&gt; resolveLink(intent.data.toString())
                null -&gt; showError(intent.scheme)
            }
        }
    }
</code></pre>
<p>If it so we can resolve deep link with resolveLink() method. There is only one required paramter - link to resolve.
And optional lambda callback. </p>
<pre><code class="lang-kotlin">private fun resolveLink(link: String) {
        RAdAttribution.linkResolver.resolve(link) {
            when (it) {
                is Result.Success -&gt; {
                }
                is Result.Error -&gt; {
                }
            }
        }
    }
</code></pre>
<h4>Demo app</h4>
<p>We provide a sample app that demonstrate the use of the Rakuten Advertising attribution SDK. You can find the open source application at this Git Repsitory</p>
<ul><li><a href="https://github.com/Rakuten-Advertising-Developers/radadvertiser-demo-android">RAd Advertiser Demo</a></li>
</ul>
<h4>Documentation</h4>
<ul><li><a href="https://rakuten-advertising-developers.github.io/RADAttribution-SDK-Android/">API References</a></li>
</ul>
<h3>Packages</h3>
<table>
<tbody>
<tr>
<td>
<p><a href="com.rakuten.attribution.sdk/index.html">com.rakuten.attribution.sdk</a></p>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3>Index</h3>
<a href="alltypes/index.html">All Types</a>
</BODY>
</HTML>
